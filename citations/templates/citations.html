{% extends "base.html" %}
{% load custom_filters %}
{% load static %}

{% block javascript %}
   <script src="{% static 'js/citations.js' %}"></script>
{% endblock %}

{% block content %}
  {% if user.is_authenticated %}
    <header style="display: flex; justify-content: flex-end; align-items: center;">
      <button onclick="location.href='/notifysubscribers'" class="outline">Notify Subscribers</button>
    </header>
  {% endif %}

  <div id="javascript-filters" style="display:none;">
    <fieldset role="group">
      <button id="filter-all" class="outline" aria-current="true" title="all web citations">
        All <span id="filter-all-count"></span>
      </button>
      <button id="filter-available" class="outline status-a" title="available at crawl time">
        Available <span id="filter-available-count"></span>
      </button>
      <button id="filter-redirect" class="outline status-r" title="redirected at crawl time">
        Redirect <span id="filter-redirect-count"></span>
      </button>
      <button id="filter-unavailable" class="outline status-u" title="unavailable at crawl time">
        Unavailable <span id="filter-unavailable-count"></span>
      </button>
    </fieldset>
  </div>

  <figure>
    <table class="sticky-header">
      <thead>
        <tr>
          <th>Verified</th>
          <th>Status</th>
          <th>Citation</th>
          <th>Memento</th>
        </tr>
      </thead>
      <tbody>
      {% for citation in citations %}
        <tr id="{{ citation.id }}">
          <td>
            {% if citation.verify_date %}
              {% if citation.perma %}
                <a target="_blank" href="{{ citation.perma }}" title="view archived capture">
                  {{ citation.verify_date|date:"Y.m.d" }}
                </a>
              {% else %}
                {{ citation.verify_date|date:"Y.m.d" }}
              {% endif %}
            {% else %}
              {% if user.is_authenticated %}
                <button onclick="location.href='/citations/verify/{{ citation.id }}'" class="button-verify outline">Verify</button>
              {% else %}
                unverified
              {% endif %}
            {% endif %}
          </td>

          <td>
            <span class="bold-text status-{{ citation.status }}">{{ citation.status }}</span>
          </td>

          <td>
            <a href="{{ citation.opinion.pdf_url }}"
               title='Cited on {{ citation.opinion.published|date:"Ymd" }} in "{{ citation.opinion.name }}"' target="_blank">
               ðŸ“–
            </a>

            {% if citation.status == 'u' %}
              {{ citation.validated|default:citation.scraped }}
            {% else %}
              <a target="_blank" href="{{ citation.validated|default:citation.scraped }}">
                {{ citation.validated|default:citation.scraped }}
              </a>
            {% endif %}
          </td>

          <td class="text-center">
            {% if citation.memento %}
              <a href="{{ citation.memento }}" target="_blank">
                <img src="/static/img/memento-logo.png" style="height: 40px; width: auto;" />
              </a>
            {% endif %}
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </figure>
{% endblock %}